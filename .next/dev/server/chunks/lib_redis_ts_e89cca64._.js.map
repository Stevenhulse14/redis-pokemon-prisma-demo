{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/profsteve/Documents/prisma-supabase-redis/lib/redis.ts"],"sourcesContent":["/**\n * Upstash Redis REST API client\n * Uses the REST API instead of node-redis to work in browser-based environments like v0\n */\nclass UpstashRedis {\n  private url: string\n  private token: string\n\n  constructor(url: string, token: string) {\n    this.url = url\n    this.token = token\n  }\n\n  private async handleResponse(response: Response): Promise<any> {\n    if (!response.ok) {\n      const text = await response.text()\n      throw new Error(`Redis API error: ${text}`)\n    }\n\n    const text = await response.text()\n    try {\n      return JSON.parse(text)\n    } catch {\n      throw new Error(`Invalid JSON response: ${text}`)\n    }\n  }\n\n  async get(key: string): Promise<string | null> {\n    try {\n      const response = await fetch(`${this.url}/get/${key}`, {\n        headers: {\n          Authorization: `Bearer ${this.token}`,\n        },\n      })\n      const data = await this.handleResponse(response)\n      return data.result\n    } catch (error) {\n      console.error(\"[redis] GET error:\", error)\n      return null\n    }\n  }\n\n  async set(key: string, value: string, options?: { EX?: number }): Promise<string | null> {\n    try {\n      const commands = options?.EX ? [\"SET\", key, value, \"EX\", options.EX.toString()] : [\"SET\", key, value]\n\n      const response = await fetch(`${this.url}`, {\n        method: \"POST\",\n        headers: {\n          Authorization: `Bearer ${this.token}`,\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(commands),\n      })\n      const data = await this.handleResponse(response)\n      return data.result\n    } catch (error) {\n      console.error(\"[redis] SET error:\", error)\n      return null\n    }\n  }\n\n  async incr(key: string): Promise<number> {\n    try {\n      const response = await fetch(`${this.url}/incr/${key}`, {\n        headers: {\n          Authorization: `Bearer ${this.token}`,\n        },\n      })\n      const data = await this.handleResponse(response)\n      return data.result\n    } catch (error) {\n      console.error(\"[redis] INCR error:\", error)\n      return 0\n    }\n  }\n\n  async mGet(keys: string[]): Promise<(string | null)[]> {\n    try {\n      const commands = [\"MGET\", ...keys]\n      const response = await fetch(`${this.url}`, {\n        method: \"POST\",\n        headers: {\n          Authorization: `Bearer ${this.token}`,\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(commands),\n      })\n      const data = await this.handleResponse(response)\n      return data.result\n    } catch (error) {\n      console.error(\"[redis] MGET error:\", error)\n      return keys.map(() => null)\n    }\n  }\n\n  async del(key: string): Promise<number> {\n    try {\n      const response = await fetch(`${this.url}/del/${key}`, {\n        headers: {\n          Authorization: `Bearer ${this.token}`,\n        },\n      })\n      const data = await this.handleResponse(response)\n      return data.result\n    } catch (error) {\n      console.error(\"[redis] DEL error:\", error)\n      return 0\n    }\n  }\n}\n\nlet redisClient: UpstashRedis | null = null\n\nexport function getRedis(): UpstashRedis | null {\n  if (redisClient) return redisClient\n\n  const url = process.env.KV_REST_API_URL\n  const token = process.env.KV_REST_API_TOKEN\n\n  if (!url || !token) {\n    console.warn(\"[redis] Upstash credentials not found. Redis caching disabled.\")\n    return null\n  }\n\n  redisClient = new UpstashRedis(url, token)\n  return redisClient\n}\n\nexport const redis = getRedis()\n"],"names":[],"mappings":"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"}}]
}