{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///Users/profsteve/Documents/prisma-supabase-redis/lib/db.ts"],"sourcesContent":["import { Pool, PoolConfig } from \"pg\"\n\nlet pool: Pool | null = null\n\nexport function getSQL(): Pool {\n  if (pool) {\n    return pool\n  }\n\n  const databaseUrl = process.env.POSTGRES_PRISMA_URL || process.env.DATABASE_URL || process.env.POSTGRES_URL\n\n  if (!databaseUrl) {\n    throw new Error(\"No database URL found in environment variables. Please set POSTGRES_PRISMA_URL, DATABASE_URL, or POSTGRES_URL\")\n  }\n\n  // Check if it's a placeholder value\n  if (databaseUrl.includes(\"your_\") || databaseUrl === \"placeholder\" || databaseUrl.startsWith(\"https://\")) {\n    throw new Error(`Invalid database URL. Please set a valid PostgreSQL connection string in POSTGRES_PRISMA_URL. Current value: ${databaseUrl.substring(0, 50)}...`)\n  }\n\n  // Basic validation - should start with postgresql:// or postgres://\n  if (!databaseUrl.startsWith(\"postgresql://\") && !databaseUrl.startsWith(\"postgres://\")) {\n    throw new Error(`Invalid database URL format. Expected postgresql:// or postgres://, got: ${databaseUrl.substring(0, 50)}...`)\n  }\n\n  // Parse connection string to extract components\n  const url = new URL(databaseUrl)\n  const isSupabase = url.hostname.includes(\"supabase\") || url.hostname.includes(\"pooler\")\n\n  // Build pool config\n  const poolConfig: PoolConfig = {\n    host: url.hostname,\n    port: parseInt(url.port) || 5432,\n    database: url.pathname.slice(1), // Remove leading slash\n    user: url.username,\n    password: url.password,\n    // SSL configuration for Supabase\n    ssl: isSupabase\n      ? {\n          rejectUnauthorized: false, // Allow self-signed certificates\n        }\n      : undefined,\n    // Additional pool settings\n    max: 20,\n    idleTimeoutMillis: 30000,\n    connectionTimeoutMillis: 10000,\n  }\n\n  // Add query parameters if present\n  url.searchParams.forEach((value, key) => {\n    if (key === \"sslmode\") {\n      // Handle sslmode parameter\n      if (value === \"require\" || value === \"prefer\") {\n        poolConfig.ssl = poolConfig.ssl || { rejectUnauthorized: false }\n      }\n    }\n  })\n\n  pool = new Pool(poolConfig)\n\n  return pool\n}\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,IAAI,OAAoB;AAEjB,SAAS;IACd,IAAI,MAAM;QACR,OAAO;IACT;IAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,mBAAmB,IAAI,QAAQ,GAAG,CAAC,YAAY,IAAI,QAAQ,GAAG,CAAC,YAAY;IAE3G,IAAI,CAAC,aAAa;QAChB,MAAM,IAAI,MAAM;IAClB;IAEA,oCAAoC;IACpC,IAAI,YAAY,QAAQ,CAAC,YAAY,gBAAgB,iBAAiB,YAAY,UAAU,CAAC,aAAa;QACxG,MAAM,IAAI,MAAM,CAAC,6GAA6G,EAAE,YAAY,SAAS,CAAC,GAAG,IAAI,GAAG,CAAC;IACnK;IAEA,oEAAoE;IACpE,IAAI,CAAC,YAAY,UAAU,CAAC,oBAAoB,CAAC,YAAY,UAAU,CAAC,gBAAgB;QACtF,MAAM,IAAI,MAAM,CAAC,yEAAyE,EAAE,YAAY,SAAS,CAAC,GAAG,IAAI,GAAG,CAAC;IAC/H;IAEA,gDAAgD;IAChD,MAAM,MAAM,IAAI,IAAI;IACpB,MAAM,aAAa,IAAI,QAAQ,CAAC,QAAQ,CAAC,eAAe,IAAI,QAAQ,CAAC,QAAQ,CAAC;IAE9E,oBAAoB;IACpB,MAAM,aAAyB;QAC7B,MAAM,IAAI,QAAQ;QAClB,MAAM,SAAS,IAAI,IAAI,KAAK;QAC5B,UAAU,IAAI,QAAQ,CAAC,KAAK,CAAC;QAC7B,MAAM,IAAI,QAAQ;QAClB,UAAU,IAAI,QAAQ;QACtB,iCAAiC;QACjC,KAAK,aACD;YACE,oBAAoB;QACtB,IACA;QACJ,2BAA2B;QAC3B,KAAK;QACL,mBAAmB;QACnB,yBAAyB;IAC3B;IAEA,kCAAkC;IAClC,IAAI,YAAY,CAAC,OAAO,CAAC,CAAC,OAAO;QAC/B,IAAI,QAAQ,WAAW;YACrB,2BAA2B;YAC3B,IAAI,UAAU,aAAa,UAAU,UAAU;gBAC7C,WAAW,GAAG,GAAG,WAAW,GAAG,IAAI;oBAAE,oBAAoB;gBAAM;YACjE;QACF;IACF;IAEA,OAAO,IAAI,4GAAI,CAAC;IAEhB,OAAO;AACT"}}]
}